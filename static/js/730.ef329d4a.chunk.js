"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[730],{50730:(e,l,a)=>{a.r(l),a.d(l,{default:()=>v});var s=a(65043),n=a(53519),t=a(84217),i=a(14282),o=a(73216),c=a(92157),d=a.n(c),r=a(73023),m=a.n(r),u=a(87960),h=a(77977),p=a(80726),x=a.n(p),j=a(70579);const v=()=>{const e=(0,o.Zp)(),[l,a]=(0,s.useState)([]),[c]=(0,s.useState)(10),[r,p]=(0,s.useState)(0),[v,g]=(0,s.useState)(1),[b,f]=(0,s.useState)(""),[N,y]=(0,s.useState)(!1),[C,S]=(0,s.useState)([]),[k,_]=(0,s.useState)(""),[w,A]=(0,s.useState)([]),[E,L]=(0,s.useState)({}),[D,P]=(0,s.useState)("");(0,s.useEffect)((()=>{const l=localStorage.getItem("token");if(null===l||void 0===l||""===l)e("/login");else{var a;T(v,c);const e=JSON.parse(localStorage.getItem("user")),l=(null===e||void 0===e||null===(a=e.master_permission)||void 0===a?void 0:a[0])||{};S(l)}}),[]);const T=(e,l)=>{a([]);fetch(`https://insuranceapi-3o5t.onrender.com/api/getAllClaims/${l}/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{var s,n,t;const i=null===(s=e.data[0])||void 0===s||null===(n=s.count[0])||void 0===n?void 0:n.total;console.log("total",i);const o=i/l,c=Math.ceil(o);p(c);const d=null===(t=e.data[0])||void 0===t?void 0:t.data;a(d)}))},[R,F]=(0,s.useState)(""),[I,$]=(0,s.useState)([]),[B,V]=(0,s.useState)({index:null,status:null,name:"",email:null});(0,s.useEffect)((()=>{U()}),[B]);const[J,O]=(0,s.useState)(!1),U=()=>{fetch("https://insuranceapi-3o5t.onrender.com/api/getSpecificEmailTemplates?type=claim",{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{if("Email template fetched"==e.message){var l,a,s;let n=null===(l=e.data)||void 0===l?void 0:l.body,t="policy_number",i=B.policy_number,o=null===n||void 0===n?void 0:n.replace(new RegExp(t,"g"),i),c="claim_status",d=B.status,r=null===o||void 0===o?void 0:o.replace(new RegExp(c,"g"),d);_(r),F(null===(a=e.data)||void 0===a?void 0:a.subject),P(null===(s=e.data)||void 0===s?void 0:s._id)}else F("Update to Your complaint"),_(`<p>Dear  ${B.name},</p><p> Your Application for claim with Policy Number ${B.policy_number} is ${B.status}.\n\n                          Thank you for choosing our services for your insurance needs.\n                          We appreciate your trust in us to safeguard your future. </p>`)}))},z=(v-1)*c;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(n.A,{children:(0,j.jsxs)("div",{className:"card mb-4",children:[(0,j.jsx)("div",{className:"card-header",children:(0,j.jsx)("div",{className:"row",children:(0,j.jsx)("div",{className:"col-md-6",children:(0,j.jsx)("h4",{className:"card-title",children:"Claims"})})})}),(0,j.jsxs)("div",{className:"card-body",children:[J?(0,j.jsx)("div",{className:"row d-flex justify-content-center",children:(0,j.jsx)(u.ul,{visible:!0,height:"80",width:"80",ariaLabel:"color-ring-loading",wrapperStyle:{},wrapperClass:"color-ring-wrapper",colors:["#e70808","#003399","#e70808","#e70808","#fff"]})}):"",(0,j.jsxs)("table",{className:"table table-bordered",children:[(0,j.jsx)("thead",{className:"thead-dark",children:(0,j.jsxs)("tr",{className:"table-info",children:[(0,j.jsx)("th",{scope:"col",children:"#"}),(0,j.jsx)("th",{scope:"col",children:"Policy Number"}),(0,j.jsx)("th",{scope:"col",children:"Name"}),(0,j.jsx)("th",{scope:"col",children:"Email"}),(0,j.jsx)("th",{scope:"col",children:"Comments"}),(0,j.jsx)("th",{scope:"col",children:"Documents"}),(0,j.jsx)("th",{scope:"col",children:"CreatedAt"}),(0,j.jsx)("th",{scope:"col",children:"Status"}),(0,j.jsx)("th",{scope:"col",children:"Remark"}),(0,j.jsx)("th",{scope:"col",children:"Action"})]})}),(0,j.jsx)("tbody",{children:(null===l||void 0===l?void 0:l.length)>0?l.map(((e,l)=>(0,j.jsxs)("tr",{children:[(0,j.jsx)("td",{children:z+l+1}),(0,j.jsx)("td",{children:e.policy_number}),(0,j.jsx)("td",{children:e.full_name}),(0,j.jsx)("td",{children:e.email}),(0,j.jsx)("td",{children:e.comments}),(0,j.jsx)("td",{children:(0,j.jsx)("button",{className:"btn btn-warning",onClick:()=>{var l;return(e=>{try{window.open(`https://insuranceapi-3o5t.onrender.com/claims/${e}`,"_blank")}catch(l){console.error("Error while opening new window:",l)}})(null===(l=e.documents)||void 0===l?void 0:l.map((e=>null===e||void 0===e?void 0:e.filename)))},children:"View"})}),(0,j.jsx)("td",{children:new Date(e.createdAt).toLocaleString()}),(0,j.jsx)("td",{children:(0,j.jsxs)("select",{defaultValue:null===e||void 0===e?void 0:e.policy_claim_status,onChange:a=>V({index:l,status:a.target.value,name:e.full_name,email:e.email,policy_number:e.policy_number}),children:[(0,j.jsx)("option",{hidden:!0,value:"",children:"Select Status "}),(0,j.jsx)("option",{value:"In Progress",children:"In Progress"}),(0,j.jsx)("option",{value:"Partially Done",children:"Partially Done"}),(0,j.jsx)("option",{value:"Completed",children:"Completed"})]})}),(0,j.jsx)("td",{children:(0,j.jsx)("input",{type:"text",placeholder:"Add Remark",className:"form-control",onChange:e=>f(e.target.value)})}),(0,j.jsx)("td",{children:(0,j.jsx)("button",{disabled:B.index!=l,onClick:()=>(async e=>{L(e),y(!0)})(e),className:"btn btn-primary",children:"Send Email"})})]},l))):(0,j.jsx)("tr",{children:(0,j.jsx)("td",{colSpan:"6",children:"No Data Found"})})})]}),(0,j.jsx)(d(),{previousLabel:"Previous",nextLabel:"Next",breakLabel:"...",pageCount:r,marginPagesDisplayed:2,pageRangeDisplayed:3,onPageChange:e=>{V({index:null,status:null,name:"",email:null});const l=e.selected;g(l+1),T(l+1,c)},containerClassName:"pagination justify-content-end",pageClassName:"page-item",pageLinkClassName:"page-link",previousClassName:"page-item",previousLinkClassName:"page-link",nextClassName:"page-item",nextLinkClassName:"page-link",breakClassName:"page-item",breakLinkClassName:"page-link",activeClassName:"active"})]})]})}),(0,j.jsxs)(t.A,{size:"lg",show:N,onHide:()=>y(!1),children:[(0,j.jsx)(t.A.Header,{closeButton:!0,children:(0,j.jsx)(t.A.Title,{children:"Send Email"})}),(0,j.jsx)(t.A.Body,{children:(0,j.jsx)("div",{className:"container",children:(0,j.jsx)("div",{className:"row",children:(0,j.jsx)("div",{className:"col-md-12",children:(0,j.jsx)("div",{className:"card",children:(0,j.jsx)("div",{className:"card-body",children:(0,j.jsxs)("form",{action:"/",method:"PUT",children:[(0,j.jsxs)("div",{className:"row",children:[(0,j.jsxs)("div",{className:"col-md-6",children:[(0,j.jsx)("label",{className:"form-label",children:(0,j.jsx)("strong",{children:"Reciever"})}),(0,j.jsx)("input",{className:"form-control",type:"text",defaultValue:B.email})]}),(0,j.jsxs)("div",{className:"col-md-6",children:[(0,j.jsxs)("label",{className:"form-label",children:[(0,j.jsx)("div",{className:"btn btn-success mx-1",onClick:()=>(()=>{const e=[...w];e.push({email:"",index:e.length+1}),A(e)})(),children:"+"}),(0,j.jsx)("strong",{children:"Add CC"})]}),null===w||void 0===w?void 0:w.map(((e,l)=>(0,j.jsxs)("div",{className:"d-flex my-1",children:[(0,j.jsx)("input",{onChange:e=>((e,l)=>{const a=[...w];a[l].email=e.target.value,A(a)})(e,l),className:"form-control",type:"text"}),(0,j.jsx)("div",{onClick:()=>(e=>{const l=[...w];l.splice(e,1),A(l)})(l),className:"btn btn-danger mx-1",children:"x"})]},l)))]}),(0,j.jsxs)("div",{className:"col-md-6",children:[(0,j.jsx)("label",{className:"form-label",children:(0,j.jsx)("strong",{children:"Add Subject"})}),(0,j.jsx)("input",{type:"text",className:"form-control",name:"name",placeholder:"Enter Subject",defaultValue:R,required:!0,autoComplete:"off",onChange:e=>F(e.target.value)})]}),(0,j.jsxs)("div",{className:"col-md-6",children:[(0,j.jsxs)("label",{className:"form-label",children:[(0,j.jsx)("div",{className:"btn btn-success mx-1",onClick:()=>(()=>{const e=[...I];e.push({file:"",index:e.length+1}),$(e)})(),children:"+"}),(0,j.jsx)("strong",{children:"Add Attatchment"})]}),null===I||void 0===I?void 0:I.map(((e,l)=>(0,j.jsxs)("div",{className:"d-flex my-1",children:[(0,j.jsx)("input",{onChange:e=>((e,l)=>{console.log(e.target.files,"file");const a=[...I];a[l].file=e.target.files,$(a)})(e,l),className:"form-control",type:"file"}),(0,j.jsx)("div",{onClick:()=>(e=>{const l=[...I];l.splice(e,1),$(l)})(l),className:"btn btn-danger mx-1",children:"x"})]},l)))]}),(0,j.jsx)("div",{className:"col-md-12",children:(0,j.jsxs)("div",{className:"form-group mb-3",children:[(0,j.jsx)("label",{children:(0,j.jsx)("strong",{children:"Email"})}),(0,j.jsx)(h.CKEditor,{editor:x(),data:k,config:{toolbar:{items:["heading","|","bold","italic","link","bulletedList","numberedList","|","indent","outdent","|","blockQuote","|","undo","redo"]},placeholder:"Start typing here..."},onReady:e=>{console.log("Editor is ready to use!",e)},onChange:(e,l)=>{const a=l.getData();console.log(a,">>>>>>>data"),_(a)},onBlur:(e,l)=>{console.log("Blur.",l)},onFocus:(e,l)=>{console.log("Focus.",l)}})]})})]}),(0,j.jsx)("div",{className:"row",children:(0,j.jsx)("div",{className:"col-md-12",children:(0,j.jsx)("div",{type:"submit",className:"btn btn-primary mt-2 submit_all",style:{float:"right"},onClick:()=>(()=>{const e=new FormData;e.append("id",E._id),e.append("email",E.email),e.append("status",E.status),e.append("remark",b),e.append("name",E.full_name),e.append("policy_number",E.policy_number),e.append("subject",R),e.append("text",k),e.append("cc",(null===w||void 0===w?void 0:w.length)>0?JSON.stringify(w.map((e=>e.email))):JSON.stringify([])),e.append("templetId",D),null===I||void 0===I||I.forEach((l=>e.append("files",l.file[0]))),fetch("https://insuranceapi-3o5t.onrender.com/api/UpdateClaimStatus",{method:"put",body:e,headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then((e=>e.json())).then((e=>{m()(e.message,"",e.type),T(v,c),O(!1)}))})(),children:"Send Email"})})})]})})})})})})}),(0,j.jsx)(t.A.Footer,{children:(0,j.jsx)(i.A,{variant:"secondary",onClick:()=>y(!1),children:"Close"})})]})]})}}}]);
//# sourceMappingURL=730.ef329d4a.chunk.js.map