"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[3109],{83109:(e,s,t)=>{t.r(s),t.d(s,{default:()=>p});var a=t(65043),n=t(73216),i=t(92157),l=t.n(i),o=t(73023),r=t.n(o),c=t(84217),d=t(14282),h=t(54168),u=t(70579);const p=()=>{var e;const s=(0,n.Zp)(),[t,i]=(0,a.useState)([]),[o]=(0,a.useState)(15),[p,m]=(0,a.useState)(0),[x,j]=(0,a.useState)(1),[v,g]=(0,a.useState)(!1),[y,b]=(0,a.useState)(!1),[f,N]=(0,a.useState)([]),[S,_]=(0,a.useState)([]),[C,T]=(0,a.useState)(""),[k,w]=(0,a.useState)([]),[A,B]=(0,a.useState)([]),[O,E]=(0,a.useState)([]),[F,P]=(0,a.useState)([]),[$,U]=(0,a.useState)([]),[I,L]=(0,a.useState)([]),[D,G]=(0,a.useState)([]),[H,V]=(0,a.useState)([]),[R,M]=(0,a.useState)("all"),[J,z]=(0,a.useState)(""),[Z,q]=(0,a.useState)(""),[K,Q]=(0,a.useState)(""),[W,X]=(0,a.useState)([]),[Y,ee]=(0,a.useState)(""),[se,te]=(0,a.useState)([]);(0,a.useEffect)((()=>{const e=localStorage.getItem("token");if(null===e||void 0===e||""===e)s("/login");else{ae(x,o),ne();const e=JSON.parse(localStorage.getItem("user")),s=(null===e||void 0===e?void 0:e.master_permission[0])||{};w(s),le(),oe(),re(),ue()}}),[]),(0,a.useEffect)((()=>{ae(x,o)}),[J,Z,K,R]);const ae=(e,s)=>{i([]);fetch(`https://insuranceapi-3o5t.onrender.com/api/getStaff?page=${e}&limit=${s}&userType=${R}&name=${J}&email=${Z}&phone=${K}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{const t=e.total/s,a=Math.ceil(t);m(a);const n=e.data,l=n.length,o=[];for(let s=0;s<l;s++){var r;const e=n[s].line_of_business,t=null===e||void 0===e?void 0:e.length,a=[];for(let s=0;s<t;s++){const t=e[s].lob_name;a.push(t)}var c=a.join(",");const i=n[s].location,l=null===i||void 0===i?void 0:i.length,u=[];for(let s=0;s<l;s++){const e=i[s].loc_name;u.push(e)}var d=u.join(",");const p=n[s].admin_business_type,m=null===p||void 0===p?void 0:p.length,x=[];for(let s=0;s<m;s++){const e=p[s].type;x.push(e)}var h=x.join(",");const j={id:n[s]._id,name:n[s].name,email:n[s].email,phone:n[s].mobile,lob:c||"",loc:d||"",status:n[s].status?n[s].status:"",admin_business_type:h||"",usertype:null===(r=n[s].usertype[0])||void 0===r?void 0:r.usertype};o.push(j)}i(o)}))},ne=()=>{fetch("https://insuranceapi-3o5t.onrender.com/api/stafflist",{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{const s=e.data,t=s.length,a=[];for(let n=0;n<t;n++){const e={_id:s[n]._id,name:s[n].name};a.push(e)}N(a)}))},ie=(e,s,t)=>{fetch(`https://insuranceapi-3o5t.onrender.com/api/updatestatusStaff/${e}/${s}?usertype=${t}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{200===e.status?r()({title:"Success",text:e.message,icon:"success",button:"Ok"}).then((()=>{ae(x,o)})):r()({title:"Error",text:e.message,icon:"error",button:"Ok"}).then((()=>{ae(x,o)}))}))},le=async()=>{await fetch("https://insuranceapi-3o5t.onrender.com/api/getAllPolicyIssuer?userType=saleAdvisor",{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{var s;null===(s=e.data)||void 0===s||s.length;void 0!=e.data&&B(e.data)}))},oe=async()=>{await fetch("https://insuranceapi-3o5t.onrender.com/api/getAllPolicyIssuer?userType=dacumentsChaser",{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{e.data.length;P(e.data)}))},re=async()=>{await fetch("https://insuranceapi-3o5t.onrender.com/api/getAllPolicyIssuer?userType=policyIsuser",{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{const s=[],t=e.data.length;for(let a=0;a<t;a++){const t={_id:e.data[a]._id,name:e.data[a].name};s.push(t)}L(s)}))},ce=e=>{E(e)},de=e=>{U(e)},he=e=>{G(e)},ue=async()=>{fetch("https://insuranceapi-3o5t.onrender.com/api/get_user_type/1/100",{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{const s=e.data;console.log(e.data,">>>>>>userTypes"),V(s)}))},pe=(x-1)*o;return(0,u.jsxs)("div",{className:"container",children:[(0,u.jsx)("div",{className:"row",children:(0,u.jsx)("div",{className:"col-md-12",children:(0,u.jsxs)("div",{className:"card",children:[(0,u.jsx)("div",{className:"card-header",children:(0,u.jsxs)("div",{className:"row",children:[(0,u.jsx)("div",{className:"col-md-6",children:(0,u.jsx)("h4",{className:"card-title",children:"Staff List"})}),(0,u.jsx)("div",{className:"col-md-6",children:null!==(e=k.staff)&&void 0!==e&&e.includes("create")?(0,u.jsx)("a",{href:"/AddStaff",className:"btn btn-primary",style:{float:"right"},children:"Add Staff"}):""})]})}),(0,u.jsx)("div",{className:"card-body",children:(0,u.jsxs)("div",{className:"row card-header",style:{marginLeft:"10px",marginRight:"10px",alignItems:"center",paddingTop:"5px",paddingBottom:"5px"},children:[(0,u.jsxs)("div",{className:"col-lg-3",children:[(0,u.jsx)("label",{children:(0,u.jsx)("strong",{children:"Search By Name"})}),(0,u.jsx)("br",{}),(0,u.jsx)("input",{type:"text",className:"form-control",placeholder:"Search",onChange:e=>z(e.target.value)})]}),(0,u.jsxs)("div",{className:"col-lg-3",children:[(0,u.jsx)("label",{children:(0,u.jsx)("strong",{children:"Search By Email"})}),(0,u.jsx)("br",{}),(0,u.jsx)("input",{type:"text",className:"form-control",placeholder:"Search",onChange:e=>q(e.target.value)})]}),(0,u.jsxs)("div",{className:"col-lg-3",children:[(0,u.jsx)("label",{children:(0,u.jsx)("strong",{children:"Search By Phone"})}),(0,u.jsx)("br",{}),(0,u.jsx)("input",{type:"text",className:"form-control",placeholder:"Search",onChange:e=>Q(e.target.value)})]}),(0,u.jsxs)("div",{className:"col-lg-3",children:[(0,u.jsx)("label",{children:(0,u.jsx)("strong",{children:"Select User Type"})}),(0,u.jsx)("br",{}),(0,u.jsxs)("select",{className:"form-control",onChange:e=>M(e.target.value),value:R,children:[(0,u.jsx)("option",{hidden:!0,children:"Select User Type"}),(0,u.jsx)("option",{value:"all",children:"All"}),null===H||void 0===H?void 0:H.map(((e,s)=>(0,u.jsx)("option",{value:e.usertype,children:e.usertype},s)))]})]})]})}),(0,u.jsx)("div",{className:"card-body",children:(0,u.jsxs)("div",{className:"table-responsive",children:[(0,u.jsxs)("table",{className:"table table-bordered",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"Sr No."}),(0,u.jsx)("th",{children:"Name"}),(0,u.jsx)("th",{children:"Email"}),(0,u.jsx)("th",{children:"Phone"}),(0,u.jsx)("th",{children:"Line Of Business"}),(0,u.jsx)("th",{children:"Location"}),(0,u.jsx)("th",{children:"Usertype"}),(0,u.jsx)("th",{children:"Business Type"}),(0,u.jsx)("th",{children:"Status"})]})}),(0,u.jsx)("tbody",{children:null===t||void 0===t?void 0:t.map(((e,s)=>{var t,a,n,i,l;return(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:pe+s+1}),(0,u.jsx)("td",{children:null!=(null===e||void 0===e?void 0:e.name)?e.name:"-"}),(0,u.jsx)("td",{children:null===e||void 0===e?void 0:e.email}),(0,u.jsx)("td",{children:null===e||void 0===e?void 0:e.phone}),(0,u.jsx)("td",{children:null===e||void 0===e?void 0:e.lob}),(0,u.jsx)("td",{children:e.loc}),(0,u.jsx)("td",{children:e.usertype}),(0,u.jsx)("td",{children:e.admin_business_type}),(0,u.jsxs)("td",{children:[(null===(t=k.staff)||void 0===t?void 0:t.includes("edit"))&&(0,u.jsx)("div",{className:"btn-group",role:"group","aria-label":"Basic example",children:(0,u.jsx)("a",{href:`/EditStaff?id=${e.id}?usertype=${e.usertype}`,className:"btn btn-primary",children:"Edit"})})," ",(null===(a=k.staff)||void 0===a?void 0:a.includes("edit"))&&("User"!=e.usertype?(0,u.jsx)("div",{className:"btn-group",role:"group","aria-label":"Basic example",children:(0,u.jsx)("a",{href:`/User_management?id=${e.id}`,className:"btn btn-info",children:"User Management"})}):"")," ",(null===(n=k.staff)||void 0===n?void 0:n.includes("delete"))&&(0,u.jsx)(u.Fragment,{children:1===e.status?(0,u.jsx)("div",{className:"btn-group",role:"group","aria-label":"Basic example",children:(0,u.jsx)("button",{className:"btn btn-danger",onClick:()=>{window.confirm("Are you sure you wish to deactivate this item?")&&ie(e.id,0,e.usertype)},children:"Deactivate"})}):(0,u.jsx)("div",{className:"btn-group",role:"group","aria-label":"Basic example",children:(0,u.jsx)("button",{className:"btn btn-success",onClick:()=>{window.confirm("Are you sure you wish to activate this item?")&&ie(e.id,1,e.usertype)},children:"Activate"})})})," ",(null===(i=k.staff)||void 0===i?void 0:i.includes("edit"))&&(0,u.jsx)(u.Fragment,{children:"Supervisor"==e.usertype?(0,u.jsx)("div",{className:"btn-group",role:"group","aria-label":"Basic example",children:(0,u.jsx)("button",{onClick:()=>{var s;s=e.id,T(s),fetch(`https://insuranceapi-3o5t.onrender.com/api/getStaffDetailsbyid/${s}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{const s=e.data;console.log("staff>>>>>>>>>>>>>>>>>>>>",s);const t=s[0].assignSalesAdvisor;if(void 0!=t){const e=t.length,s=[];for(let a=0;a<e;a++){const e={_id:t[a]._id,name:t[a].name};s.push(e)}E(t)}const a=s[0].assignDacumentChaser;if(void 0!=a){const e=a.length,s=[];for(let t=0;t<e;t++){const e={_id:a[t]._id,name:a[t].name};s.push(e)}U(s)}const n=s[0].assignPolicyIssuer;if(void 0!=n){const e=n.length,s=[];for(let t=0;t<e;t++){const e={_id:n[t]._id,name:n[t].name};s.push(e)}G(s)}g(!0)}))},className:"btn btn-primary",children:"Assign Staff"})}):""}),(null===(l=k.staff)||void 0===l?void 0:l.includes("edit"))&&(0,u.jsx)(u.Fragment,{children:"Supervisor"==e.usertype||"Sales Advisor"==e.usertype||"Document Chaser"==e.usertype||"Policy Issuer"==e.usertype?(0,u.jsx)("div",{className:"btn-group",role:"group","aria-label":"Basic example",children:(0,u.jsx)("button",{onClick:()=>((e,s)=>{ee(s);const t={method:"GET",headers:{"Content-Type":"application/json"}};fetch(`https://insuranceapi-3o5t.onrender.com/api/getSubUserTypes?usertype=${e}`,t).then((e=>e.json())).then((e=>{const s=e.data;console.log(e.data,">>>>>>userTypes");const t=[];for(let a=0;a<s.length;a++)t.push({_id:s[a]._id,usertype:s[a].usertype});X(t)})),fetch(`https://insuranceapi-3o5t.onrender.com/api/getUserMultiRole?id=${s}`,t).then((e=>e.json())).then((e=>{var s;e.data,console.log(e.data,">>>>>> default userTypes"),te(null===(s=e.data[0])||void 0===s?void 0:s.subusertypes)})),b(!0)})(e.usertype,e.id),className:"btn btn-warning mx-1",children:"Multi User"})}):""})]})]},s)}))})]}),(0,u.jsx)(l(),{previousLabel:"Previous",nextLabel:"Next",breakLabel:"...",pageCount:p,marginPagesDisplayed:2,pageRangeDisplayed:3,onPageChange:e=>{const s=e.selected+1;j(s),ae(s,o)},containerClassName:"pagination justify-content-end",pageClassName:"page-item",pageLinkClassName:"page-link",previousClassName:"page-item",previousLinkClassName:"page-link",nextClassName:"page-item",nextLinkClassName:"page-link",breakClassName:"page-item",breakLinkClassName:"page-link",activeClassName:"active"})]})})]})})}),(0,u.jsxs)(c.A,{size:"lg",show:v,onHide:()=>g(!1),children:[(0,u.jsx)(c.A.Header,{closeButton:!0,children:(0,u.jsx)(c.A.Title,{children:"Assign Staff"})}),(0,u.jsx)(c.A.Body,{children:(0,u.jsx)("div",{className:"container",children:(0,u.jsx)("div",{className:"row",children:(0,u.jsx)("div",{className:"col-md-12",children:(0,u.jsx)("div",{className:"card",children:(0,u.jsx)("div",{className:"card-body",children:(0,u.jsxs)("form",{action:"/",method:"POST",onSubmit:e=>{e.preventDefault();null===O||void 0===O||O.map((e=>e._id)),null===$||void 0===$||$.map((e=>e._id)),null===D||void 0===D||D.map((e=>e._id));console.log("sa_ids>>>>>>>>>>>>>>>>>>>>",null===O||void 0===O?void 0:O.map((e=>e._id))),console.log("dc_ids>>>>>>>>>>>>>>>>>>>>",null===$||void 0===$?void 0:$.map((e=>e._id))),console.log("pi_ids>>>>>>>>>>>>>>>>>>>>",null===D||void 0===D?void 0:D.map((e=>e._id)));const s=C,t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({assignSalesAdvisor:null===O||void 0===O?void 0:O.map((e=>e._id)),assignDacumentChaser:null===$||void 0===$?void 0:$.map((e=>e._id)),assignPolicyIssuer:null===D||void 0===D?void 0:D.map((e=>e._id))})};fetch(`https://insuranceapi-3o5t.onrender.com/api/assignStaff/${s}`,t).then((e=>e.json())).then((e=>{200===e.status?r()({title:"Success",text:e.message,icon:"success",button:"Ok"}).then((()=>{g(!1),ae(x,o,R)})):r()({title:"Error",text:e.message,icon:"error",button:"Ok"}).then((()=>{g(!1),ae(x,o,R)}))}))},children:[(0,u.jsxs)("div",{className:"row",children:[(0,u.jsx)("div",{className:"col-md-12",children:(0,u.jsxs)("div",{className:"form-group mb-3",children:[(0,u.jsx)("label",{children:(0,u.jsx)("strong",{children:"Sales Advisor"})}),(0,u.jsx)(h.default,{options:A,selectedValues:O,onSelect:ce,onRemove:ce,displayValue:"name",closeOnSelect:!1,avoidHighlightFirstOption:!0,showCheckbox:!0,style:{chips:{background:"#007BFF"}},showArrow:!0})]})}),(0,u.jsx)("div",{className:"col-md-12",children:(0,u.jsxs)("div",{className:"form-group mb-3",children:[(0,u.jsx)("label",{children:(0,u.jsx)("strong",{children:"Document Chaser"})}),(0,u.jsx)(h.default,{options:F,selectedValues:$,onSelect:de,onRemove:de,displayValue:"name",closeOnSelect:!1,avoidHighlightFirstOption:!0,showCheckbox:!0,style:{chips:{background:"#007BFF"}},showArrow:!0})]})}),(0,u.jsx)("div",{className:"col-md-12",children:(0,u.jsxs)("div",{className:"form-group mb-3",children:[(0,u.jsx)("label",{children:(0,u.jsx)("strong",{children:"Policy Issuer"})}),(0,u.jsx)(h.default,{options:I,selectedValues:D,onSelect:he,onRemove:he,displayValue:"name",closeOnSelect:!1,avoidHighlightFirstOption:!0,showCheckbox:!0,style:{chips:{background:"#007BFF"}},showArrow:!0})]})})]}),(0,u.jsx)("div",{className:"row",children:(0,u.jsx)("div",{className:"col-md-12",children:(0,u.jsx)("button",{type:"submit",className:"btn btn-primary mt-2 submit_all",style:{float:"right"},children:"Update"})})})]})})})})})})}),(0,u.jsx)(c.A.Footer,{children:(0,u.jsx)(d.A,{variant:"secondary",onClick:()=>g(!1),children:"Close"})})]}),(0,u.jsxs)(c.A,{size:"lg",show:y,onHide:()=>b(!1),children:[(0,u.jsx)(c.A.Header,{closeButton:!0,children:(0,u.jsx)(c.A.Title,{children:"Sub User Type"})}),(0,u.jsx)(c.A.Body,{children:(0,u.jsx)("div",{className:"container",children:(0,u.jsx)("div",{className:"row",children:(0,u.jsx)("div",{className:"col-md-12",children:(0,u.jsx)("div",{className:"card",children:(0,u.jsx)("div",{className:"card-body",children:(0,u.jsxs)("form",{action:"/",method:"POST",children:[(0,u.jsx)("div",{className:"row",children:(0,u.jsx)("div",{className:"col-md-6",children:(0,u.jsxs)("div",{className:"form-group mb-3",children:[(0,u.jsx)("label",{children:(0,u.jsx)("strong",{children:"Select Sub User"})}),(0,u.jsx)(h.default,{options:W,selectedValues:se,onSelect:e=>te(e),onRemove:e=>te(e),displayValue:"usertype",closeOnSelect:!1,avoidHighlightFirstOption:!0,showCheckbox:!0,style:{chips:{background:"#007BFF"}},showArrow:!0})]})})}),(0,u.jsx)("div",{className:"row",children:(0,u.jsx)("div",{className:"col-md-12",children:(0,u.jsx)("div",{type:"submit",onClick:()=>(()=>{const e={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:Y,userTypeData:se})};fetch("https://insuranceapi-3o5t.onrender.com/api/updateSubUserTypes",e).then((e=>e.json())).then((e=>{console.log(e,"last data"),200==e.status?(r()({title:"success",text:e.message,icon:"success",button:!1}),setTimeout((()=>{r().close()}),1e3)):(r()({title:"error",text:e.message,icon:"success",button:!1}),setTimeout((()=>{r().close()}),1e3))}))})(),className:"btn btn-primary mt-2 submit_all",style:{float:"right"},children:"Update"})})})]})})})})})})}),(0,u.jsx)(c.A.Footer,{children:(0,u.jsx)(d.A,{variant:"secondary",onClick:()=>b(!1),children:"Close"})})]})]})}}}]);
//# sourceMappingURL=3109.3e7f7612.chunk.js.map